---
title: "망연계 솔루션 배포를 위한 Shell Script 자동화 빌드 & 배포 시스템 구축"
order: 7
startDate: "2017-05-01"
endDate: "2017-07-31"
description: "서버별 환경 통합 관리를 위한 Shell Script 기반 자동화 빌드 & 배포 시스템 구축"
tags: ["Linux", "Unix", "Shell Script", "정규식"]
company: "유채널"
---

## 프로젝트 개요

기관별 DMZ 영역에 존재하는 중계, 연계서버에 망 연계 솔루션이 포팅됨에 따라, 서버마다 상이한 환경변수 및 설정 정보를 통합하여 관리할 수 있는 빌드 & 배포 시스템을 구축했습니다. Shell Script를 활용한 완전 자동화된 배포 파이프라인을 통해 수동 배포 과정에서 발생하는 휴먼 에러를 최소화하고, 배포 시간을 대폭 단축했습니다.

## 프로젝트 정보

- **고객사**: 부산은행
- **포지션**: Server
- **개발 인원**: 1명

## 기술 스택

- **OS**: Linux, Unix, AIX
- **Scripting**: Shell Script (Bash)
- **Tools**: 정규식, scp, ssh

## 자동화 빌드 & 배포 시스템 Spec

### 1. **서버별 환경 및 접속정보에 대한 `*.config` 파일 자동 생성**

- 서버 ID, IP, Port, Destination 정보를 파라미터로 받아 환경 설정 파일 자동 생성
- 환경별(dev, staging, online) 설정 파일 분리 관리
- 표준화된 포맷으로 통합 관리

### 2. **서버별 고유 ID 지정 및 중복 검증**

- 서버 고유 ID 할당 시스템
- 중복 ID 자동 검증 로직
- ID 충돌 발생 시 에러 메시지 출력 및 배포 중단

### 3. **서버별 배포 파일 생성 및 로그 경로 지정**

- 서버별 커스터마이징된 배포 모듈 자동 생성
- 로그 파일 경로 자동 설정 및 디렉토리 생성
- 배포 이력 및 버전 관리

### 4. **망 연계 솔루션 운용 및 모니터링 환경 제공**

- 솔루션 시작/중지/상태 확인 명령어 제공
- 프로세스 상태 모니터링
- 에러 로그 실시간 확인

### 5. **로그 파일 자동 제거 프로그램**

- 오래된 로그 파일 자동 삭제 스케줄러
- 디스크 용량 관리 및 최적화
- 로그 보관 정책 적용 (N일 이전 로그 삭제)

## 명령어 시스템

### 1. **환경 파일 생성**

```bash
$ configGen.sh res serverId ip port destination_ip:port
```

**기능**:
- 서버 ID, IP, Port, Destination 정보를 기반으로 `*.config` 파일 자동 생성
- 환경 설정 파일 템플릿 적용
- 파라미터 유효성 검증

**생성 결과**:
- `serverId.config` 파일 생성
- 서버 접속 정보 및 환경 변수 설정 포함

### 2. **빌드 & 배포**

**환경 설정**:
```bash
$ lmw_config.sh (dev|staging|online) (serverId|all) [destination_path]
```

**빌드 및 배포**:
```bash
$ lmw_build.sh (dev|staging|online) (serverId|all) [destination_path]
```

**기능**:
- **환경별 분리**: dev, staging, online 환경 선택 가능
- **서버 선택**: 특정 서버 또는 전체 서버 일괄 배포
- **정규식 기반 치환**: 템플릿 파일에서 정규식을 활용하여 서버별 환경 변수 자동 치환
- **원격 배포**: scp 명령어를 통한 원격 서버 전송
- **권한 설정**: 배포 후 자동으로 실행 권한 부여

**프로세스**:
1. `*.config` 파일 참조하여 환경 변수 로드
2. 공통 파일 및 템플릿 파일 수집
3. 정규식을 활용하여 서버별 환경 변수 치환
4. 서버별 배포 모듈 패키징
5. scp를 통한 원격 서버 전송
6. SSH를 통한 원격 명령 실행 (권한 설정, 디렉토리 생성 등)
7. 배포 로그 기록

### 3. **운용 및 모니터링**

```bash
$ lmwSolution.sh (start|stop|status)
```

**기능**:
- **start**: 망 연계 솔루션 시작
- **stop**: 망 연계 솔루션 중지
- **status**: 현재 실행 상태 확인

**모니터링 기능**:
- 프로세스 상태 확인 (PID, CPU, Memory)
- 로그 파일 tail 실시간 모니터링
- 에러 발생 시 알림

## 담당 업무

### 1. **Shell Script 기반 자동화 시스템 설계 및 구현**

- 빌드 & 배포 프로세스 자동화 설계
- Shell Script를 활용한 스크립트 개발
- 정규식 패턴 설계 및 구현

### 2. **환경 설정 파일 자동 생성 스크립트**

- `configGen.sh` 개발
- 파라미터 검증 및 에러 핸들링
- 설정 파일 템플릿 설계 및 적용

### 3. **빌드 및 배포 스크립트 개발**

- `lmw_config.sh` 및 `lmw_build.sh` 개발
- 정규식을 활용한 환경 변수 치환 로직 구현
- 환경별(dev, staging, online) 분기 처리
- 서버별 배포 모듈 자동 생성

### 4. **원격 배포 자동화**

- scp를 활용한 파일 전송 자동화
- SSH를 통한 원격 명령 실행
- 배포 후 권한 설정 및 환경 검증
- 배포 실패 시 롤백 처리

### 5. **운용 및 모니터링 스크립트**

- `lmwSolution.sh` 개발 (start/stop/status)
- 프로세스 상태 모니터링 로직
- 로그 파일 관리 및 자동 삭제 스크립트

### 6. **다중 OS 환경 대응**

- Linux, Unix 환경별 호환성 테스트
- OS별 차이점 대응 (명령어, 경로 등)
- 크로스 플랫폼 스크립트 작성

## 개발 구현 내용

### Shell Script 개발

1. **환경 파일 생성 스크립트 (configGen.sh)**
   - 파라미터 파싱 및 유효성 검증
   - 서버 ID 중복 검증 로직
   - 템플릿 기반 설정 파일 생성
   - 에러 핸들링 및 로그 기록

2. **빌드 스크립트 (lmw_build.sh)**
   - 환경별 소스 코드 수집
   - 정규식 기반 환경 변수 치환
   - 서버별 커스터마이징 처리
   - 배포 모듈 패키징 (tar, zip 등)
   - 빌드 로그 생성

3. **배포 스크립트 (lmw_config.sh)**
   - 원격 서버 접속 정보 로드
   - scp를 통한 파일 전송
   - SSH를 통한 원격 명령 실행
   - 배포 후 검증 (파일 존재 확인, 권한 확인)
   - 배포 이력 기록

4. **운용 스크립트 (lmwSolution.sh)**
   - 프로세스 시작/중지 제어
   - PID 파일 관리
   - 프로세스 상태 모니터링
   - 로그 파일 tail 기능

### 정규식 패턴 설계

5. **환경 변수 치환 정규식**
   - 템플릿 파일에서 `${VARIABLE_NAME}` 형태의 변수 추출
   - sed 명령어를 활용한 치환 처리
   - 다중 변수 일괄 치환 로직
   - 특수 문자 이스케이프 처리

### 시스템 통합 및 최적화

6. **배포 파이프라인 구축**
   - 환경 생성 → 빌드 → 배포 → 검증의 자동화 파이프라인
   - 단계별 에러 핸들링 및 롤백 처리
   - 배포 로그 및 이력 관리

7. **로그 관리 자동화**
   - cron을 활용한 주기적 로그 삭제
   - 로그 압축 및 아카이빙
   - 디스크 용량 모니터링

8. **에러 핸들링 및 복구**
   - 배포 실패 시 자동 롤백
   - 에러 로그 수집 및 알림
   - 재시도 로직 구현

## 프로젝트 성과

- **배포 시간 단축**: 수동 배포 대비 시간 단축
- **휴먼 에러 감소**: 자동화를 통한 설정 오류 제로화
- **운영 효율성 향상**: 서버별 환경 통합 관리로 유지보수성 개선
- **다중 OS 대응**: Linux, Unix 환경에서 동일한 스크립트로 배포 가능
