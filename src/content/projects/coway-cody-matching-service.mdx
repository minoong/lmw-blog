---
title: '실시간 코디 매칭 서비스'
order: 1
startDate: '2022-06-01'
endDate: '2023-06-30'
description: '위치 기반 매칭 서비스 - 고객과 코디네이터를 실시간으로 연결하는 서비스 개발 및 PL 업무'
tags: ['React', 'TypeScript', 'Vite', 'TanStack Query', 'React Router v6', 'E2E:Cypress', 'Geolocation API', 'T MAP API', 'GA4', 'GTM']
company: "코웨이"
---

## 프로젝트 개요

고객과 코웨이 전문 코디네이터를 실시간으로 가까운 지역의 제품 전문가 코디와 연결되는 구매 상담 전용 서비스입니다. 고객의 제품 문의나 서비스 요청을 근처 코디네이터에게 즉시 매칭하여 SMS 및 카카오톡 알림톡 서비스를 제공하는 서비스를 운영하였습니다.

**서비스 URL**: [https://matching.coway.com/request](https://matching.coway.com/request)

## 기술 스택

- **Frontend**: React, TypeScript
- **Build Tool**: Vite
- **Data Fetching**: TanStack Query (React Query)
- **Routing**: React Router v6
- **Location Services**: TMAP API, Geolocation API, KAKAO 우편번호 서비스
- **Analytics**: GA4 (Google Analytics 4), GTM (Google Tag Manager)
- **Notification**: SMS, 카카오톡 알림톡 API
- **E2E Testing**: Cypress

## 주요 과제

### 1. 위치 기반 실시간 코디 매칭 서비스

고객 위치를 기반으로 가까운 코디네이터를 실시간으로 매칭하는 서비스을 운영하였습니다.

#### 위치 정보 수집

Geolocation API를 활용하여 사용자의 실시간 위치를 수집하고, TMAP API를 통해 좌표를 주소로 변환했습니다. KAKAO 우편번호 서비스를 통해 수동 주소 입력 지원

#### TanStack Query 실시간 동기화

5초 주기 폴링으로 코디네이터 매칭 수락 상태를 실시간으로 검증하고, 매칭 상태를 즉시 반영했습니다. AbortController를 활용하여 중복 호출을 방지하고 페이지 이탈 시 모든 pending 요청을 취소하도록 구현했습니다.

### 2. React Router v5 → v6 마이그레이션

기존 프로젝트의 React Router를 v5에서 v6로 업그레이드하여 성능과 개발 경험을 개선했습니다.

#### 중첩 라우팅 최적화

React Router v6의 Outlet 패턴을 도입하여 레이아웃 컴포넌트 재사용과 라우트 계층 구조를 명확화했습니다. 이를 통해 레이아웃 컴포넌트 중복을 제거하고 불필요한 리렌더링을 방지하여 성능을 향상시켰습니다.

#### 코드 스플리팅

React.lazy()와 Suspense를 활용하여 라우트별 번들을 분리했습니다.

- 초기 번들 크기 감소
- 페이지 로딩 속도 개선

### 3. 심야시간 매칭 예약 서비스

기존 실시간 매칭 로직에 영향을 주지 않고, 심야시간(22:00 ~ 08:00) 체크 로직을 분리하여 구현했습니다. 시간대별로 다른 UI 컴포넌트를 렌더링하되, 핵심 비즈니스 로직은 재사용하는 구조로 설계/구현했습니다.

### 4. 매칭 상태별 페이지 구현

고객과 코디네이터 매칭 성공 시 SMS 및 카카오톡 알림톡을 통해 제공되는 매칭 완료 URL에 접속하면 매칭 상태에 따라 다른 페이지가 렌더링됩니다.

### 5. 블랙리스트 유저 관리

악의적으로 매칭 요청을 반복하는 사용자를 식별하고(내부 정책을 따름), 블랙리스트에 등록하여 매칭 요청을 차단하는 기능을 구현했습니다.

1. **블랙리스트 사용자 식별**
    - 매칭 요청 횟수, 취소 이력 등을 기반으로 블랙리스트 사용자 식별
2. **매칭 요청 차단**
    - 블랙리스트 사용자에 대해 매칭 요청 시도 시 경고 메시지를 표시하고 요청을 차단

### 6. 관심 제품 카테고리 선택 기능

고객이 관심 있는 제품 카테고리를 선택할 수 있도록 UI를 구현하여, 코디네이터가 고객의 관심사에 맞는 제품을 추천할 수 있도록 설계/구현했습니다.

코디네이터는 매칭 요청 시 고객의 관심 제품 카테고리를 확인할 수 있도록 하여, 맞춤형 상담이 가능하도록 했습니다.

- **Backend**:  API 연동을 통해 고객이 선택한 카테고리 정보를 매칭 요청 시 함께 전송
- **고객**: 관심 제품 카테고리 선택 UI
- **코디네이터**: 고객 관심사 확인 UI

### 7. 사용자 행동 분석 및 최적화

GA4와 GTM을 활용하여 사용자 행동을 분석하고 서비스를 최적화했습니다.

#### GA4 이벤트 트래킹

매칭 퍼널 이벤트 트래킹을 설정하여 각 단계별 이탈률을 분석했습니다.
- **평균 매칭 시간**: 요청 → 매칭 완료까지 소요 시간
- **취소율**: 전체 요청 대비 취소된 매칭 비율
- **재매칭률**: 첫 매칭 실패 후 재요청 비율

#### GTM 커스텀 트리거

위치 권한 거부율과 매칭 대기 이탈 지점을 추적하여 사용자 이탈 원인을 추적할 수 있도록 GTM 커스텀 트리거를 설정했습니다.

### 8. Cypress E2E 테스트

실시간 코디 매칭 시나리오를 멀티 브라우저 환경으로 테스트

**테스트 환경 구성**:
- Cypress를 활용한 E2E 테스트 자동화
- 3개의 독립적인 브라우저 창 시뮬레이션 (고객, 코디1, 코디2)
- 실제 매칭 프로세스 전체 플로우 검증

**매칭 경쟁 시나리오 테스트**:

1. **고객 매칭 요청**:
   - 고객 브라우저에서 위치 기반 매칭 요청 실행
   - 매칭 ID 생성 및 대기 상태 진입

2. **매칭 ID 조회**:
   - API를 통해 생성된 매칭 ID 조회
   - 해당 매칭에 할당된 코디네이터 목록 중 2개 ID 추출

3. **코디 경쟁 시나리오**:
   - 코디1, 코디2 브라우저를 동시에 실행
   - 두 코디가 동일한 매칭 요청에 대해 수락 경쟁
   - 먼저 수락한 코디가 매칭 성공, 늦은 코디는 실패 처리

**테스트 케이스**:

**매칭 완료 케이스**:
- 코디1이 먼저 수락 → 매칭 완료 상태 확인
- 고객 화면에 매칭된 코디 정보 표시 검증
- 코디2는 "이미 매칭된 요청" 메시지 확인

**매칭 실패 케이스**:
- 두 코디 모두 수락하지 않고 타임아웃
- 고객 화면에 매칭 실패 메시지 표시
- 재매칭 요청 버튼 활성화 확인

**장점**:
- 실제 사용자 시나리오 기반 테스트로 신뢰도 향상
- 멀티 브라우저 동시 실행으로 경쟁 조건(race condition) 검증
